<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Glitch — Скачать приложение</title>
  <meta name="theme-color" content="#111111" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <style>
    /* ── Reset & Base ── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #ffffff;
      --text: #111111;
      --text-secondary: #666666;
      --card-bg: #f5f5f5;
      --card-border: #e0e0e0;
      --badge-bg: #111111;
      --badge-text: #ffffff;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #111111;
        --text: #f0f0f0;
        --text-secondary: #999999;
        --card-bg: #1a1a1a;
        --card-border: #2a2a2a;
        --badge-bg: #ffffff;
        --badge-text: #111111;
      }
    }

    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100dvh;
      padding: 24px;
    }

    /* ── Container ── */
    .container {
      width: 100%;
      max-width: 380px;
      text-align: center;
    }

    .app-icon {
      width: 80px;
      height: 80px;
      border-radius: 18px;
      margin: 0 auto 16px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      overflow: hidden;
    }

    .app-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    h1 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
      letter-spacing: -0.02em;
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 28px;
    }

    /* ── Store links ── */
    .store-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .store-link {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 18px;
      border-radius: 14px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      text-decoration: none;
      color: var(--text);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .store-link:active {
      transform: scale(0.97);
    }

    .store-link-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .store-link-icon svg {
      width: 24px;
      height: 24px;
    }

    .store-link-info {
      text-align: left;
    }

    .store-link-label {
      font-size: 11px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 2px;
    }

    .store-link-name {
      font-size: 16px;
      font-weight: 600;
    }

    /* ── Redirect (iOS) screen ── */
    .redirect-message {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .redirect-message a {
      color: var(--text);
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    /* ── Loading / Detecting ── */
    .detecting {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--card-border);
      border-top-color: var(--text);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      margin-bottom: 8px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* ── Hidden by default ── */
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <!-- Detecting screen -->
  <div class="container" id="screen-detecting">
    <div class="spinner"></div>
    <p class="detecting">Определяем устройство…</p>
  </div>

  <!-- iOS redirect screen -->
  <div class="container hidden" id="screen-ios">
    <div class="app-icon">G</div>
    <h1>Glitch</h1>
    <p class="subtitle">Перенаправляем в App Store…</p>
    <p class="redirect-message">
      Если ничего не произошло, <a id="ios-manual-link" href="#">нажмите здесь</a>.
    </p>
  </div>

  <!-- Android / Other store selection screen -->
  <div class="container hidden" id="screen-android">
    <div class="app-icon">G</div>
    <h1>Glitch</h1>
    <p class="subtitle">Выберите магазин приложений</p>
    <div class="store-list" id="store-list">
      <!-- Populated by JS -->
    </div>
  </div>

  <!-- Desktop / Unknown fallback -->
  <div class="container hidden" id="screen-fallback">
    <div class="app-icon">G</div>
    <h1>Glitch</h1>
    <p class="subtitle">Скачайте приложение на телефон</p>
    <div class="store-list" id="store-list-fallback">
      <!-- Populated by JS -->
    </div>
  </div>

  <script>
    // ═══════════════════════════════════════════════
    // CONFIG — edit links here
    // ═══════════════════════════════════════════════
    const CONFIG = {
      appName: 'Glitch',

      // iOS — auto-redirect target
      ios: 'https://apps.apple.com/ru/app/glitch/id6746337888',

      // Android stores — shown as list
      stores: [
        {
          id: 'google-play',
          name: 'Google Play',
          label: 'Скачать из',
          url: 'https://drive.google.com/file/d/13YxgMHuw981OzaufwkYe6838OjfvfNii/view?usp=sharing',
          icon: 'img/googlestore.svg',
        },
        {
          id: 'rustore',
          name: 'RuStore',
          label: 'Скачать из',
          url: 'https://www.rustore.ru/catalog',
          icon: null, // inline SVG used below
        },
        {
          id: 'appgallery',
          name: 'AppGallery',
          label: 'Скачать из',
          url: 'https://appgallery.huawei.com/',
          icon: null, // inline SVG used below
        },
        {
          id: 'apk',
          name: 'Скачать APK',
          label: 'Прямая ссылка',
          url: 'https://drive.google.com/file/d/13YxgMHuw981OzaufwkYe6838OjfvfNii/view?usp=sharing',
          icon: 'img/apk.svg',
        },
      ],
    };
    // ═══════════════════════════════════════════════

    // ── Inline icons for stores without SVG files ──
    const INLINE_ICONS = {
      'rustore': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>`,
      'appgallery': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><path d="M12 8v8"/><path d="M8 12h8"/></svg>`,
    };

    // ── Device detection ──
    function detectPlatform() {
      const ua = navigator.userAgent || navigator.vendor || window.opera || '';
      const platform = navigator.platform || '';
      const maxTouchPoints = navigator.maxTouchPoints || 0;

      // iOS detection (covers iPhone, iPad, iPod, and iPadOS 13+ which reports as Mac)
      const isIOS =
        /iP(hone|od|ad)/i.test(ua) ||
        /iP(hone|od|ad)/i.test(platform) ||
        (/Mac/i.test(platform) && maxTouchPoints > 1) ||
        (/Macintosh/i.test(ua) && maxTouchPoints > 1);

      if (isIOS) return 'ios';

      // Android detection
      const isAndroid = /Android/i.test(ua);
      if (isAndroid) return 'android';

      // HarmonyOS / Huawei detection (some devices)
      if (/HarmonyOS/i.test(ua) || /Huawei/i.test(ua)) return 'android';

      return 'other';
    }

    // ── Render store list ──
    function renderStoreList(containerId) {
      const container = document.getElementById(containerId);
      CONFIG.stores.forEach(function(store) {
        const a = document.createElement('a');
        a.className = 'store-link';
        a.href = store.url;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';

        let iconHtml = '';
        if (store.icon) {
          iconHtml = '<img src="' + store.icon + '" alt="" style="width:100%;height:100%;object-fit:contain;border-radius:10px;">';
        } else if (INLINE_ICONS[store.id]) {
          iconHtml = INLINE_ICONS[store.id];
        }

        a.innerHTML =
          '<div class="store-link-icon">' + iconHtml + '</div>' +
          '<div class="store-link-info">' +
            '<div class="store-link-label">' + store.label + '</div>' +
            '<div class="store-link-name">' + store.name + '</div>' +
          '</div>';

        container.appendChild(a);
      });
    }

    // ── Main logic ──
    function init() {
      var platform = detectPlatform();

      // Short delay for visual feedback
      setTimeout(function() {
        document.getElementById('screen-detecting').classList.add('hidden');

        if (platform === 'ios') {
          document.getElementById('screen-ios').classList.remove('hidden');
          document.getElementById('ios-manual-link').href = CONFIG.ios;
          // Auto-redirect
          window.location.href = CONFIG.ios;
        } else if (platform === 'android') {
          renderStoreList('store-list');
          document.getElementById('screen-android').classList.remove('hidden');
        } else {
          // Desktop / unknown — show all options
          renderStoreList('store-list-fallback');
          document.getElementById('screen-fallback').classList.remove('hidden');
        }
      }, 300);
    }

    init();
  </script>
</body>
</html>
